<!DOCTYPE html> <!-- –£–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ HTML5 -->
<html lang="ru"> <!-- –Ø–∑—ã–∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî —Ä—É—Å—Å–∫–∏–π -->

<head>
  <meta charset="UTF-8" /> <!-- –ö–æ–¥–∏—Ä–æ–≤–∫–∞: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –∏ —ç–º–æ–¥–∑–∏ -->
  <meta name="viewport" content="width=device-width,initial-scale=1" /> <!-- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ -->
  <title>–°—á—ë—Ç—á–∏–∫ —Å–æ –∑–≤—ë–∑–¥–∞–º–∏</title> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ -->

  <style>
    /* ======= –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò ======= */
    body {
      font-family: sans-serif; /* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —à—Ä–∏—Ñ—Ç */
      text-align: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç */
      background: #f9f9f9; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ */
      margin: 0;
      padding: 30px 11px;
    }
    .text-cell {
      width: 100%;
    }
    .container {
      display: flex; /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
      justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —à–∏—Ä–∏–Ω–µ */
      align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤—ã—Å–æ—Ç–µ */
      gap: 0;
      flex-wrap: nowrap;
      overflow-x: auto; /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ */
      position: relative;
      height: 100px;
    }

    .circle {
      width: 64px;
      height: 64px;
      border-radius: 50%; /* –î–µ–ª–∞–µ–º –∫—Ä—É–≥ */
      background: #eee; /* –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      line-height: 48px;
      margin-left: -30px; /* –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.2); /* –¢–µ–Ω—å */
      position: relative;
      z-index: 1;
    }

    .circle:first-child {
      margin-left: 0; /* –ü–µ—Ä–≤—ã–π –∫—Ä—É–≥ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç—Å—è */
    }

    .form-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: nowrap;
      margin: 10px 0;
      position: relative;
    }

    .form-row input[type="text"] {
      font-size: 16px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 100%;
      flex: 1; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è */
    }

    .form-row input[type="number"] {
      font-size: 16px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 40px;
      text-align: center;
    }

    .form-row .emoji-option {
      flex-shrink: 0;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
    }

    .form-row .emoji-option.selected {
      border: 2px solid #4caf50; /* –ó–µ–ª—ë–Ω–∞—è —Ä–∞–º–∫–∞ */
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.5); /* –°–≤–µ—Ç—è—â–∞—è—Å—è —Ç–µ–Ω—å */
    }

    .form-row button {
      font-size: 24px;
      padding: 6px 15px;
      border-radius: 50%;
      border: none;
      background: #dcdcdc;
      cursor: pointer;
      flex-shrink: 0;
    }

    .form-row button:hover {
      background: #ccc;
    }

    #entryList {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      border: none;
    }

    #entryList th,
    #entryList td {
      border: none;
      padding: 8px;
      text-align: left;
    }

    #entryList th {
      background-color: #f4f4f4;
      font-weight: bold;
    }

    #entryList .emoji-cell {
      white-space: nowrap;
      text-align: center;
      width: 1%;
    }

    #entryList .emoji-cell .circle {
      width: 24px;
      height: 24px;
      font-size: 16px;
      line-height: 24px;
      margin-left: -12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: #eee;
      box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
    }

    #entryList .emoji-cell .circle:first-child {
      margin-left: 0;
    }

    .result-count {
      margin-left: 16px;
      font-size: 40px !important;
      font-weight: bold;
      color: black !important;
    }

    .autocomplete-list {
      position: absolute;
      left: 0;
      top: 100%; /* –ü–æ–¥ input'–æ–º */
      margin-top: 2px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      max-height: 160px;
      overflow-y: auto;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      min-width: 180px;
    }

    .autocomplete-item {
      padding: 6px 10px;
      cursor: pointer;
    }

    .autocomplete-item:hover,
    .autocomplete-item.active {
      background: #f0f0f0;
    }

    /* ======= –ú–ï–î–ò–ê-–°–¢–ò–õ–ò –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ ======= */
    @media (max-width: 600px) {
      body {
        padding: 10px 2px;
      }

      .container {
        height: auto;
        flex-wrap: wrap;
        min-height: 60px;
      }

      .circle {
        width: 48px;
        height: 48px;
        font-size: 24px;
        line-height: 48px;
        margin-left: -30px;
      }

      .form-row {
        flex-wrap: wrap;
        gap: 4px;
        margin: 6px 0;
      }

      .form-row input[type="text"] {
        font-size: 15px;
        padding: 5px 8px;
        width: 100%;
        max-width: 100%;
      }

      .form-row input[type="number"] {
        font-size: 15px;
        padding: 5px 8px;
        width: 38px;
      }

      .form-row button {
        font-size: 18px;
        padding: 5px 10px;
      }

      .emoji-option {
        font-size: 18px;
        padding: 4px;
      }

      #entryList {
        font-size: 13px;
        margin-top: 6px;
        display: block;
        overflow-x: auto;
        width: 100vw;
        min-width: 320px;
      }

      #entryList th,
      #entryList td {
        font-size: 13px;
        padding: 5px;
        min-width: 60px;
        word-break: break-word;
      }

      #entryList .emoji-cell .circle {
        width: 18px;
        height: 18px;
        font-size: 12px;
        line-height: 18px;
        margin-left: -7px;
      }

      #entryList .emoji-cell .circle:first-child {
        margin-left: 0;
      }

      .result-count {
        font-size: 48px;
        margin-left: 8px;
      }

      .autocomplete-list {
        min-width: 120px;
        font-size: 14px;
        max-height: 100px;
      }
    }
  </style>
</head>

<body>
  <!-- –ë–ª–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–≥–æ —Å—á—ë—Ç–∞ -->
  <div class="container" id="resultDisplay"></div>

  <h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</h2>
  <div class="form-row">
    <!-- –í–≤–æ–¥ –∏–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏ -->
    <input type="text" id="entryName" autocomplete="off" />
    <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ -->
    <div id="autocompleteList" class="autocomplete-list" style="display:none"></div>
    <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ -->
    <input type="number" id="entryCount" value="1" min="1" />
    <!-- –≠–º–æ–¥–∑–∏ –∑–≤–µ–∑–¥–∞ -->
    <div class="emoji-option" data-type="star" onclick="selectEmoji('star')">‚≠ê</div>
    <!-- –≠–º–æ–¥–∑–∏ –∑–ª–æ—Å—Ç—å -->
    <div class="emoji-option" data-type="x" onclick="selectEmoji('x')">üò°</div>
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <button id="saveBtn">+</button>
  </div>

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –∫–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ -->
  <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
    <h2>–ò—Å—Ç–æ—Ä–∏—è</h2>
    <button id="clearHistoryBtn">üóëÔ∏è</button>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –∏—Å—Ç–æ—Ä–∏—è–º–∏ -->
  <table id="entryList"></table>

  <script>
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
    let entries = JSON.parse(localStorage.getItem('entries') || '[]');
    let counter = parseInt(localStorage.getItem('counter') || '0', 10);
    let selectedEmojiType = 'star';
    let nameSuggestions = JSON.parse(localStorage.getItem('nameSuggestions') || '[]');

    // –°–æ–∑–¥–∞–Ω–∏–µ –∫—Ä—É–≥–∞ —Å —ç–º–æ–¥–∑–∏
    function createCircle(type, zIndex) {
      const circle = document.createElement('div');
      circle.className = 'circle';
      circle.textContent = type === 'star' ? '‚≠ê' : 'üò°';
      circle.style.backgroundColor = type === 'star' ? '#fff8dc' : '#ffeaea';
      circle.style.zIndex = zIndex;
      return circle;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function updateResult() {
      const container = document.getElementById('resultDisplay');
      container.innerHTML = '';

      const absCount = Math.abs(counter);
      const type = counter >= 0 ? 'star' : 'x';

      for (let i = 0; i < absCount; i++) {
        container.appendChild(createCircle(type, i + 1));
      }

      const count = document.createElement('div');
      count.className = 'result-count';
      count.textContent = absCount;
      container.appendChild(count);
    }

    // –†–∏—Å—É–µ–º —Ç–∞–±–ª–∏—Ü—É –∏—Å—Ç–æ—Ä–∏–∏
    function renderList() {
      const list = document.getElementById('entryList');
      list.innerHTML = `
        <thead><tr><th>–î–∞—Ç–∞</th><th class="text-cell">–ù–∞–∑–≤–∞–Ω–∏–µ</th><th class="emoji-cell">–≠–º–æ–¥–∑–∏</th></tr></thead>
        <tbody>
        ${entries.slice().reverse().map(e => `
          <tr>
            <td>${e.date}</td>
            <td class="text-cell">${e.name}</td>
            <td class="emoji-cell">
              ${Array(e.count).fill(`<div class="circle">${e.type === 'star' ? '‚≠ê' : 'üò°'}</div>`).join('')}
            </td>
          </tr>
        `).join('')}
        </tbody>
      `;
    }

    // –í—ã–±–æ—Ä —ç–º–æ–¥–∑–∏
    function selectEmoji(type) {
      selectedEmojiType = type;
      document.querySelectorAll('.emoji-option').forEach(el => el.classList.remove('selected'));
      document.querySelector(`.emoji-option[data-type="${type}"]`).classList.add('selected');
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
    function saveNameSuggestion(name) {
      if (!name) return;
      if (!nameSuggestions.includes(name)) {
        nameSuggestions.push(name);
        localStorage.setItem('nameSuggestions', JSON.stringify(nameSuggestions));
      }
    }

    // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ
    function showAutocompleteList(value) {
      const list = document.getElementById('autocompleteList');
      if (!value) return (list.style.display = 'none', list.innerHTML = '');
      const matches = nameSuggestions.filter(n => n.toLowerCase().includes(value.toLowerCase()));
      if (!matches.length) return (list.style.display = 'none', list.innerHTML = '');
      list.innerHTML = matches.map((n, i) => `<div class="autocomplete-item">${n}</div>`).join('');
      list.style.display = 'block';
    }

    function hideAutocompleteList() {
      document.getElementById('autocompleteList').style.display = 'none';
    }

    document.getElementById('entryName').addEventListener('input', e => showAutocompleteList(e.target.value));
    document.getElementById('entryName').addEventListener('blur', () => setTimeout(hideAutocompleteList, 150));
    document.getElementById('autocompleteList').addEventListener('mousedown', e => {
      if (e.target.classList.contains('autocomplete-item')) {
        document.getElementById('entryName').value = e.target.textContent;
        hideAutocompleteList();
      }
    });

    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä–µ–ª–æ–∫ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑ –∏ Enter
    document.getElementById('entryName').addEventListener('keydown', function (e) {
      const list = document.getElementById('autocompleteList');
      const items = [...list.querySelectorAll('.autocomplete-item')];
      let idx = items.findIndex(item => item.classList.contains('active'));
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (idx >= 0) items[idx].classList.remove('active');
        idx = (idx + 1) % items.length;
        items[idx].classList.add('active');
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (idx >= 0) items[idx].classList.remove('active');
        idx = (idx - 1 + items.length) % items.length;
        items[idx].classList.add('active');
      } else if (e.key === 'Enter' && idx >= 0) {
        this.value = items[idx].textContent;
        hideAutocompleteList();
        e.preventDefault();
      }
    });

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
    function addEntry() {
      const name = document.getElementById('entryName').value.trim();
      const cnt = parseInt(document.getElementById('entryCount').value, 10);
      if (!name || isNaN(cnt) || cnt < 1 || !selectedEmojiType) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, —á–∏—Å–ª–æ (1+) –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —ç–º–æ–¥–∑–∏.');
        return;
      }

      saveNameSuggestion(name);
      const type = selectedEmojiType;
      const now = new Date();
      const date = `${now.getDate()}.${now.getMonth() + 1}`;

      entries.push({ name, type, count: cnt, date });
      counter += type === 'star' ? cnt : -cnt;

      saveAndRefresh();
      selectEmoji('star'); // –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞
    }

    // –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
    function clearHistory() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é?')) {
        entries = [];
        localStorage.removeItem('entries');
        renderList();
      }
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    function saveAndRefresh() {
      localStorage.setItem('entries', JSON.stringify(entries));
      localStorage.setItem('counter', counter.toString());
      document.getElementById('entryName').value = '';
      document.getElementById('entryCount').value = '1';
      renderList();
      updateResult();
    }

    // –°–≤—è–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
    document.getElementById('saveBtn').onclick = addEntry;
    document.getElementById('clearHistoryBtn').onclick = clearHistory;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    selectEmoji('star');
    renderList();
    updateResult();
  </script>
</body>
</html>
<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>FlexLife</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>


    <div style="display:flex;width:100%;height:250px;border:1px solid #ccc;">
        <!-- Счётчик -->
        <div id="counter"
            style="flex:1;display:flex;justify-content:center;align-items:center;font-size:64px;font-weight:bold;color:red;">
            0
        </div>
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;padding:10px;">
            <img width="64px" id="image" src="/reward/1.png" alt=""
                style="max-width:100%;height:auto;margin-bottom:8px;">
            <div style="width:100%;background:#eee;height:20px;border-radius:10px;overflow:hidden;">
                <div id="progress" style="width:0%;height:100%;background:green;transition:width 0.5s;"></div>
            </div>
        </div>
    </div>
    <button onclick="animateCounter(-100)">+</button>
    <button onclick="animateImage('reward/2.png')">-</button>

    <div style="margin-bottom: 8px;"></div>




    <script>
        // #region Widget counter + image + progress
        const counterEl = document.getElementById("counter");
        const imageEl = document.getElementById("image");
        const progressEl = document.getElementById("progress");

        let counterValue = 0;
        let progressMax = 100;
        let progressValue = 0;

        function setCounter(value) {
            counterValue = value;
            counterEl.textContent = value;
        }

        function getCounter() {
            return counterValue;
        }

        function setImage(url) {
            imageEl.src = url;
        }

        function setProgressMax(max) {
            progressMax = max;
        }

        function setProgressValue(value) {
            progressValue = Math.min(value, progressMax);
            let percent = (progressValue / progressMax) * 100;
            progressEl.style.width = percent + "%";
        }

        // анимированное изменение значения счётчика
        function animateCounter(toValue, duration = 1000) {
            let fromValue = counterValue;
            let start = null;

            function step(timestamp) {
                if (!start) start = timestamp;
                let progress = Math.min((timestamp - start) / duration, 1);
                let current = Math.floor(fromValue + (toValue - fromValue) * progress);
                setCounter(current);
                if (progress < 1) requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        }

        function animateProgress(toValue, duration = 1000) {
            let fromValue = progressValue;
            let start = null;

            function step(timestamp) {
                if (!start) start = timestamp;
                let progress = Math.min((timestamp - start) / duration, 1);
                let current = fromValue + (toValue - fromValue) * progress;
                setProgressValue(current);
                if (progress < 1) requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        }

        function animateImage(url, duration = 1000) {
            imageEl.style.transition = `opacity ${duration / 2}ms`;
            imageEl.style.opacity = 0;

            setTimeout(() => {
                imageEl.src = url;
                imageEl.onload = () => {
                    imageEl.style.opacity = 1;
                };
            }, duration / 2);
        }
        // Пример использования




        // #endregion


    </script>

</body>

</html>